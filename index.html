<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Urna Eletrônica – Eleições Gerais</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  margin:0;font-family:Arial;background:#0b1c2d;
  display:flex;flex-direction:column;align-items:center;color:#fff;
}
.top{position:fixed;top:10px;right:10px;display:flex;gap:8px}
.top button{padding:8px 12px;border-radius:8px;font-weight:bold}
.urna{margin-top:80px;width:400px;background:#1e2f45;border-radius:16px;padding:16px}
.screen{background:#000;padding:12px;border-radius:10px;min-height:260px}
.digits{display:flex;justify-content:center;gap:8px}
.digit{width:40px;height:55px;background:#fff;color:#000;font-size:26px;
display:flex;align-items:center;justify-content:center}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-top:10px}
.key{background:#000;color:#fff;padding:14px;font-size:18px}
.green{background:#0a0}
.green.piscar{animation:p 1s infinite}
@keyframes p{50%{opacity:.3}}
.orange{background:#f70}
.white{background:#fff;color:#000}
#candidate img{width:90px;height:90px;border-radius:50%;margin:8px}
#founderPanel,#solicitar{position:fixed;inset:0;background:rgba(0,0,0,.8);
display:none;justify-content:center;align-items:center}
.box{background:#fff;color:#000;padding:20px;border-radius:12px;width:90%;max-width:500px}
.box input,.box button,select{width:100%;margin-top:6px;padding:8px}
pre{background:#eee;padding:8px;max-height:200px;overflow:auto}
</style>
</head>

<body>

<div class="top">
<button id="btnSolicitar">Solicitar Título</button>
<button id="btnBoletim">Boletim</button>
<button id="btnFundador">Fundador</button>
</div>

<div class="urna">
<div class="screen">
<div id="label">DIGITE SEU TÍTULO</div>
<div class="digits" id="digits"></div>
<div id="candidate"></div>
</div>

<div class="grid">
<button class="key" data-n="1">1</button><button class="key" data-n="2">2</button><button class="key" data-n="3">3</button>
<button class="key" data-n="4">4</button><button class="key" data-n="5">5</button><button class="key" data-n="6">6</button>
<button class="key" data-n="7">7</button><button class="key" data-n="8">8</button><button class="key" data-n="9">9</button>
</div>

<div style="display:flex;gap:6px;margin-top:6px">
<button class="white" id="branco">BRANCO</button>
<button class="key" data-n="0">0</button>
<button class="orange" id="corrige">CORRIGE</button>
<button class="green" id="confirma">CONFIRMA</button>
</div>
</div>

<!-- SOLICITAR TÍTULO -->
<div id="solicitar">
<div class="box">
<h3>Solicitar Título</h3>
<input id="nome" placeholder="Nome completo">
<input id="estado" placeholder="Estado">
<button id="criarTitulo">Criar</button>
</div>
</div>

<!-- FUNDADOR -->
<div id="founderPanel">
<div class="box">
<h3>Painel do Fundador</h3>

<input id="senhaBol" placeholder="Senha boletim (3 dígitos)">
<button id="saveSenha">Salvar senha boletim</button>

<hr>

<input id="ipDel" placeholder="IP para apagar votos">
<button id="delIp">Apagar votos por IP</button>

<hr>

<button id="verEleitores">Ver Eleitores</button>
<button onclick="founderPanel.style.display='none'">Fechar</button>

<pre id="out"></pre>
</div>
</div>

<audio id="somConfirma" src="https://www.myinstants.com/media/sounds/confirma-urna-eletronica.mp3"></audio>
<audio id="somFim" src="https://www.myinstants.com/media/sounds/urna-eletronica-confirma.mp3"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, get, set, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const app=initializeApp({
apiKey:"AIzaSyCPnLB16tErzJZ4kozY4zfxJE3-dWOw4S0",
databaseURL:"https://urna-96bf5-default-rtdb.firebaseio.com"
});
const db=getDatabase(app);

let ip="";
fetch("https://api.ipify.org?format=json").then(r=>r.json()).then(d=>ip=d.ip);

btnSolicitar.onclick=()=>solicitar.style.display="flex";
criarTitulo.onclick=async()=>{
await set(ref(db,"eleitores/"+ip),{
nome:nome.value,estado:estado.value,ip,data:new Date().toLocaleString()
});
alert("Título criado. Urna liberada.");
solicitar.style.display="none";
};

btnFundador.onclick=()=>{
if(prompt("Senha fundador")!=="7070")return;
founderPanel.style.display="flex";
};

saveSenha.onclick=()=>set(ref(db,"config/senhaBoletim"),senhaBol.value);

btnBoletim.onclick=async()=>{
const s=prompt("Senha boletim");
const r=await get(ref(db,"config/senhaBoletim"));
if(!r.exists()||r.val()!=s)return alert("Senha errada");
const v=await get(ref(db,"votos"));
alert(JSON.stringify(v.val(),null,2));
};

verEleitores.onclick=async()=>{
const r=await get(ref(db,"eleitores"));
out.textContent=JSON.stringify(r.val(),null,2);
};

delIp.onclick=async()=>{
await remove(ref(db,"eleitores/"+ipDel.value));
await remove(ref(db,"votosPorIp/"+ipDel.value));
alert("Votos apagados");
};
</script>
</body>
</html>
